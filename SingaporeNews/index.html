<!DOCTYPE html>
<meta charset="utf-8">

<style>
  body {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .x.axis path {
    display: none;
  }

  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
  }
</style>

<body>
<script src="http://d3js.org/d3.v3.js"></script>

<script>

var margin = {top: 20, right: 20, bottom: 30, left: 50},
  width = 960 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;

var x = d3.scale.linear()
          .range([0, width]);

var y = d3.scale.linear()
          .range([height, 0]);

var color = d3.scale.category20();

d3.csv("transposed_terms.csv", function(error, data){

  var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .ticks(55);

  var yAxis = d3.svg.axis()
    .scale(y)
    .orient('left');

  var line = d3.svg.line()
    .x(function(d){ return x(d.year); })
    .y(function(d){ return y(d.count); });
  
  color.domain(d3.keys(
    data[0]).filter(function(key){ return key !== 'headline_year'; }
    )
  );

  var headline_terms = color.domain().map(function(term){
    return {
      term: term,
      values: data.map(function(d){
        return {year: d.headline_year, count: +d[term]};
      })
    };
  });

  used_data = headline_terms.filter(function(d){ return d.term == 'bomb'; });
  console.log(used_data.values);

  var minY = d3.min(used_data, function(c){ return d3.min(c.values, function(v){
                return v.count; });
              });

  var maxY = d3.max(used_data, function(c){ return d3.max(c.values, function(v){
                return v.count; });
              });

  x.domain(used_data.values.map(function(d){ return d.year; }));

  y.domain([minY, maxY]);

  var svg = d3.select('body').append('svg')
                .attr("width", width + margin.left + margin.right + margin.right)
                .attr("height", height + margin.top + margin.bottom*2)
                .attr('class', 'line_svg')
              .append('g')
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  svg.append('g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + height + ')')
      .call(xAxis);

  svg.append('g')
      .attr('class', 'y axis')
      .call(yAxis)
    .append('text')
      .attr('transform', 'rotate(-90)')
      .attr('y', 6)
      .attr('dy', '.71em')
      .style('text-anchor', 'end')
      .text('Count');

  var terms = svg.append('g')
            .attr('class', 'terms');

  var termsLines = terms.selectAll('.line')
      .data(used_data);

  termsLines.enter().append('path')
      .attr('class', 'line');

  termsLines.exit().remove();

  termsLines
    .attr('d', function(d){ return line(d.values); });

});

</script>

</body>
